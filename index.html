<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Bacteria ID Quiz — Fixed</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; margin:18px; background:#f7fafc; color:#0f172a; }
    h1 { margin:0 0 12px; font-size:20px; }
    .controls { display:flex; gap:8px; align-items:center; margin-bottom:12px; }
    button { padding:8px 10px; border-radius:8px; border:1px solid #cbd5e1; background:white; cursor:pointer; }
    input[type=text] { padding:8px; width:520px; border-radius:8px; border:1px solid #cbd5e1; }
    .card { background:white; padding:14px; border-radius:10px; box-shadow:0 1px 4px rgba(2,6,23,0.06); }
    .image-container { margin:18px 0; display:flex; flex-wrap:wrap; gap:12px; }
    .image-item { width:200px; text-align:center; }
    .image-item img { width:100%; height:140px; object-fit:cover; border-radius:6px; border:1px solid #e2e8f0; background:#eee; }
    .dot { width:18px; height:18px; border-radius:50%; display:inline-block; margin-right:6px; border:2px solid rgba(0,0,0,0.06); }
    .dot.correct { background:#10b981; border-color:#086f4a; box-shadow:0 0 8px rgba(16,185,129,0.15); }
    .dot.partial { background:#3b82f6; border-color:#1e40af; box-shadow:0 0 8px rgba(59,130,246,0.12); }
    .dot.incorrect { background:#ef4444; border-color:#7f1d1d; box-shadow:0 0 8px rgba(239,68,68,0.12); }
    .dot.current { background:#8b5cf6; border-color:#5b21b6; box-shadow:0 0 8px rgba(139,92,246,0.12); }
    .accordion { background:#f1f5f9; border:1px solid #e2e8f0; padding:10px; cursor:pointer; margin-top:8px; border-radius:6px; text-align:left; }
    .panel { display:none; background:white; padding:8px; border-radius:6px; border:1px solid #eef2ff; margin-top:6px; }
    .summary { margin-bottom:12px; font-weight:600; }
    .small-muted { color:#64748b; font-size:13px; margin-top:8px; display:block; }
    .property-tag { display:inline-block; background:#eff6ff; border:1px solid #bfdbfe; color:#1e40af; padding:4px 10px; border-radius:6px; margin:4px; font-size:13px; font-weight:500; }
  </style>
</head>
<body>
  <div style="max-width:1100px;margin:0 auto;">
    <h1>Bacteria Identification Quiz</h1>

    <div id="quizArea" class="card">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
        <div id="progressDots" style="display:flex;gap:6px;"></div>
        <div style="margin-left:auto;font-weight:600;" id="progressText">0 / 0</div>
      </div>

      <div id="imageArea" class="image-container"></div>
      
      <div id="propertiesArea" style="margin:12px 0;"></div>

      <div style="display:flex;gap:8px;align-items:center;">
        <input id="answerInput" type="text" placeholder="Type bacteria name (e.g., Streptococcus pyogenes)" />
        <button id="submitBtn">Submit</button>
        <button id="nextBtn" style="display:none">Next</button>
      </div>

      <div id="feedbackBox" style="margin-top:12px;display:none;padding:12px;border-radius:8px;"></div>

      <div class="small-muted">All clues shown. Multi-organism cards accept partial answers that can be upgraded to full credit.</div>
    </div>

    <div id="reviewArea" class="card" style="margin-top:18px;display:none;">
      <!-- review content injected here -->
    </div>
  </div>

<script>
/* ========= Dataset with ALL attributes from database ========= */
const BACTERIA_DATA = [
  { name: "Listeria and Cornyebacterium", clues:["gram-positive-bacilli"], oxReq:"aerobic", encapsulated:false, spore:false },
  { name: "Bacillus", clues:["gram-positive-bacilli"], oxReq:"aerobic", encapsulated:true, spore:true },
  { name: "Clostridioides", clues:["gram-positive-bacilli"], oxReq:"anaerobic", encapsulated:false, spore:true },
  { name: "Staphylococcus saprophyticus Staphylococcus epidermidis", clues:["gram-positive-staphylococci","catalase-positive","coagulase-negative"], oxReq:"aerobic", encapsulated:false, spore:false },
  { name: "Staphylococcus aureus", clues:["gram-positive-staphylococci","catalase-positive","coagulase-positive"], oxReq:"aerobic", encapsulated:true, spore:false },
  { name: "Streptococcus mutans Streptococcus mitis", clues:["gram-positive-streptococci","catalase-negative","alpha-hemolysis","optochin-resistant"], oxReq:"aerobic", encapsulated:false, spore:false },
  { name: "Streptococcus pneumoniae", clues:["gram-positive-streptococci","catalase-negative","alpha-hemolysis","optochin-sensitive"], oxReq:"aerobic", encapsulated:true, spore:false },
  { name: "Streptococcus agalactiae (Group B Strep)", clues:["gram-positive-streptococci","catalase-negative","beta-hemolysis","bacitracin-resistant"], oxReq:"aerobic", encapsulated:true, spore:false },
  { name: "Streptococcus pyogenes (Group A Strep)", clues:["gram-positive-streptococci","catalase-negative","beta-hemolysis","bacitracin-sensitive"], oxReq:"aerobic", encapsulated:true, spore:false },
  { name: "Streptococcus bovis (nonenterococcus)", clues:["gram-positive-streptococci","catalase-negative","gamma-hemolysis","nacl-no-growth"], oxReq:"aerobic", encapsulated:false, spore:false },
  { name: "Enterococcus faecium Enterococcus faecalis", clues:["gram-positive-streptococci","catalase-negative","gamma-hemolysis","nacl-growth"], oxReq:"aerobic", encapsulated:false, spore:false },
  { name: "Nocardia", clues:["gram-positive-branching","acid-fast-weak"], oxReq:"aerobic", encapsulated:false, spore:false },
  { name: "Actinomyces", clues:["gram-positive-branching","acid-fast-no"], oxReq:"anaerobic", encapsulated:false, spore:false },
  { name: "Neisseria gonorrhea and Moraxella spp.", clues:["gram-negative-diplococci","maltose-negative"], oxReq:"aerobic", encapsulated:false, spore:false },
  { name: "Neisseria meningitidis", clues:["gram-negative-diplococci","maltose-positive"], oxReq:"aerobic", encapsulated:true, spore:false },
  { name: "Acinetobacter Brucella F. tularensis", clues:["gram-negative-coccobacilli"], oxReq:null, encapsulated:false, spore:false },
  { name: "Haemophilus influenzae Bordetella pertussis", clues:["gram-negative-coccobacilli"], oxReq:null, encapsulated:true, spore:false },
  { name: "Shigella", clues:["gram-negative-bacilli","lactose-negative","oxidase-negative","h2s-negative"], oxReq:null, encapsulated:false, spore:false },
  { name: "Yersinia", clues:["gram-negative-bacilli","lactose-negative","oxidase-negative","h2s-negative"], oxReq:null, encapsulated:true, spore:false },
  { name: "Salmonella", clues:["gram-negative-bacilli","lactose-negative","oxidase-negative","h2s-positive"], oxReq:null, encapsulated:true, spore:false },
  { name: "Proteus", clues:["gram-negative-bacilli","lactose-negative","oxidase-negative","h2s-positive"], oxReq:null, encapsulated:false, spore:false },
  { name: "Pseudomonas", clues:["gram-negative-bacilli","lactose-negative","oxidase-positive"], oxReq:null, encapsulated:true, spore:false },
  { name: "Citrobacter Serratia", clues:["gram-negative-bacilli","lactose-slow"], oxReq:null, encapsulated:false, spore:false },
  { name: "Enterobacter", clues:["gram-negative-bacilli","lactose-fast"], oxReq:null, encapsulated:false, spore:false },
  { name: "Klebsiella", clues:["gram-negative-bacilli","lactose-fast"], oxReq:null, encapsulated:true, spore:false },
  { name: "Escherichia coli", clues:["gram-negative-bacilli","lactose-fast"], oxReq:null, encapsulated:"only meningeal strains", spore:false },
  { name: "Campylobacter jejuni", clues:["gram-negative-comma","oxidase-positive","grows-42c"], oxReq:null, encapsulated:false, spore:false },
  { name: "Vibrio cholera", clues:["gram-negative-comma","oxidase-positive","alkaline-media"], oxReq:null, encapsulated:false, spore:false },
  { name: "Helicobacter pylori", clues:["gram-negative-comma","oxidase-positive","urease-positive"], oxReq:null, encapsulated:false, spore:false }
];

/* ========= IMAGE LIBRARY ========= */
const IMAGE_LIBRARY = {
  "gram-positive-staphylococci": { url: "https://www.atsu.edu/faculty/chamberlain/mosdoh/images/gmposcocci.jpg", caption: "Positive Gram stain, staphylococci" },
  "gram-positive-streptococci": { url: "https://i0.wp.com/microbeonline.com/wp-content/uploads/2021/05/enterococcus-gram-positive-oval-cocci-in-pairs.jpg?ssl=1", caption: "Positive Gram stain, streptococci" },
  "gram-positive-bacilli": { url: "https://www.weber.edu/wsuimages/kendalbeazer/AerobicGramRods/BacillusSubtilis.jpg", caption: "Positive Gram stain, bacilli" },
  "gram-positive-branching": { url: "https://www.idimages.org/images/organisms/A00010/A00010_04_m_lab.jpg", caption: "Positive Gram stain, branching" },

  "gram-negative-diplococci": { url: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/Gonococcal_urethritis_PHIL_4085_lores.jpg/1920px-Gonococcal_urethritis_PHIL_4085_lores.jpg", caption: "Negative Gram stain, diplococci" },
  "gram-negative-coccobacilli": { url: "https://www.bioedonline.org/BioEd/cache/file/845CDE08-60CF-42D1-B033829FA616283E.jpg", caption: "Negative Gram stain, coccobacilli" },
  "gram-negative-bacilli": { url: "https://www.atsu.edu/faculty/chamberlain/mosdoh/images/gmnegrod.jpg", caption: "Negative Gram stain, bacilli" },
  "gram-negative-comma": { url: "https://media.sciencephoto.com/image/c0573205/800wm/C0573205-Vibrio_comma_bacteria,_light_micrograph.jpg", caption: "Negative Gram stain, comma-shaped" },

  "alpha-hemolysis": { url: "https://www.shutterstock.com/image-photo/alpha-hemolysis-on-blood-agar-600nw-1020756763.jpg", caption: "Hemolysis plate" },
  "beta-hemolysis": { url: "https://open.maricopa.edu/app/uploads/sites/287/2022/01/Beta-hemolysis-.jpg", caption: "Hemolysis plate" },
  "gamma-hemolysis": { url: "https://open.maricopa.edu/app/uploads/sites/287/2022/01/Gamma-hemolysis-.jpg", caption: "Hemolysis plate" },

  "catalase-positive": { url: "https://live.staticflickr.com/2130/2414768507_6b5bcf3ebe_c.jpg", caption: "Catalase positive" },
  "catalase-negative": { url: "https://live.staticflickr.com/2086/2414769831_5d340320de_c.jpg", caption: "Catalase negative" },

  "bacitracin-sensitive": { url: "https://ars.els-cdn.com/content/image/3-s2.0-B9780750601870500079-f02-14-9780750601870.jpg", caption: "Bacitracin sensitivity (zone around disk)" },
  "bacitracin-resistant": { url: "https://www.mdpi.com/vetsci/vetsci-10-00642/article_deploy/html/images/vetsci-10-00642-g004-550.jpg", caption: "Bacitracin resistant (no zone)" },

  "optochin-sensitive": { url: "https://www.keyscientific.com/image.php?type=P&id=2286", caption: "Optochin sensitive (zone around disk)" },
  "optochin-resistant": { url: "https://www.mdpi.com/vetsci/vetsci-10-00642/article_deploy/html/images/vetsci-10-00642-g004-550.jpg", caption: "Optochin resistant (no zone)" },

  "coagulase-positive": { url: "https://open.maricopa.edu/app/uploads/sites/297/2022/09/Coagulase-positive-1536x1152.jpg", caption: "Coagulase positive" },
  "coagulase-negative": { url: "https://open.maricopa.edu/app/uploads/sites/297/2022/09/Coagulase-Negative-1536x1152.jpg", caption: "Coagulase negative" },

  "oxidase-positive": { url: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTQaKeUVSJCnyuC3jZHhznhD9ZNRCNuwlbhIg&s", caption: "Oxidase positive (purple)" },
  "oxidase-negative": { url: "https://media.cheggcdn.com/study/b70/b70977f8-fd40-4966-bc5e-f6e8b477ea7e/image", caption: "Oxidase negative (no color change)" },

  "urease-positive": { url: "https://axiommedicals.com/cdn/shop/products/Halyard-Rapid-Urease-Test-CLIA-Waived_grande.jpg?v=1620503016", caption: "Urease positive (pink)" },

  "h2s-positive": { url: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQRyUYFHf83YLvKTGQ13mXRlHtpHGyTdzwcGA&s", caption: "H₂S production (blackening)" },
  "h2s-negative": { url: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTMIjH08018mgqTKFBsIPFT5iuoRciJ5p3CxA&s", caption: "H₂S negative (no blackening)" },

  "acid-fast-weak": { url: "https://upload.wikimedia.org/wikipedia/commons/5/57/Nocardia_gram_and_acid_fast.jpg", caption: "Weak acid fast" },
  "acid-fast-no": { url: "https://upload.wikimedia.org/wikipedia/commons/5/57/Nocardia_gram_and_acid_fast.jpg", caption: "Acid fast negative" },

  "maltose-positive": { url: "https://vumicro.com/wp-content/uploads/2022/07/yelybynnnn-2018_07_01-17_21_39-UTC.jpg", caption: "Maltose positive" },
  "maltose-negative": { url: "https://vumicro.com/wp-content/uploads/2022/07/redybynnnn-2018_07_01-17_21_39-UTC.jpg", caption: "Maltose negative" },

  "nacl-growth": { url: "https://vumicro.com/wp-content/uploads/2022/07/ambybynnyn-2018_07_01-17_21_39-UTC.jpg", caption: "Growth in 6.5% NaCl" },
  "nacl-no-growth": { url: "https://vumicro.com/wp-content/uploads/2022/07/ambybnnnnn-2018_07_01-17_21_39-UTC.jpg", caption: "No growth in 6.5% NaCl" },

  "lactose-fast": { url: "https://cwoer.ccbcmd.edu/science/microbiology/lab%20manual/lab12/images/MAC_EC_sf_crop_arrows.jpg", caption: "Fast lactose fermenter" },
  "lactose-slow": { url: "https://cwoer.ccbcmd.edu/science/microbiology/lab%20manual/lab12/images/MAC_EC_sf_crop_arrows.jpg", caption: "Slow lactose fermenter" },
  "lactose-negative": { url: "https://cwoer.ccbcmd.edu/science/microbiology/lab%20manual/lab12/images/MAC%20none%202_final.jpg", caption: "Macconkey Agar" },

  "grows-42c": { url: "https://microbiologyinfo.com/wp-content/uploads/2019/04/featured-growth-at-42-test.jpg.webp", caption: "Grows at 42°C" },
  "alkaline-media": { url: "https://ichef.bbci.co.uk/images/ic/480xn/p01ghr6y.jpg", caption: "Grows in alkaline media" }
};

/* ========= State ========= */
let quizData = BACTERIA_DATA.slice();
let currentIndex = 0;
let correctAnswers = [];
let partialAnswers = [];
let incorrectAnswers = [];

/* ========= Utilities ========= */
function normalize(s) {
  return String(s || "").toLowerCase().trim().replace(/[^\w\s]/g, ' ');
}

function evaluateAnswer(userInput, cardName) {
  const user = normalize(userInput);
  if (!user) return false;

  const raw = cardName.replace(/\s+/g,' ').trim();
  let candidates = raw.split(/\s+(?:and|&|,)\s+|\/|;|\band\b/i).map(s=>s.trim()).filter(Boolean);

  const expanded = [];
  for (let c of candidates) {
    const matches = c.match(/[A-Z][a-z]+(?:\s+[a-z-]+)+/g);
    if (matches && matches.length > 1) {
      matches.forEach(m => expanded.push(m.trim()));
    } else {
      expanded.push(c);
    }
  }
  const uniqueCandidates = Array.from(new Set(expanded.map(x => x.trim()).filter(Boolean)));

  const matched = [];
  for (let cand of uniqueCandidates) {
    const candNorm = normalize(cand);
    const parts = candNorm.split(/\s+/).filter(Boolean);
    const joined = parts.join(' ');
    if (joined.length >= 3 && user.includes(joined)) {
      matched.push(cand);
      continue;
    }
    if (parts.length >= 2) {
      const epithet = parts.slice(1).join(' ');
      if (epithet && user.includes(epithet)) {
        matched.push(cand);
        continue;
      }
    }
    const genus = parts[0];
    if (genus && user.includes(genus)) {
      matched.push(cand);
      continue;
    }
    for (let t of parts) {
      if (t.length >= 3 && user.includes(t)) {
        matched.push(cand);
        break;
      }
    }
  }

  const uniqueMatched = Array.from(new Set(matched));
  if (uniqueMatched.length === uniqueCandidates.length && uniqueCandidates.length > 0) return true;
  if (uniqueMatched.length > 0 && uniqueMatched.length < uniqueCandidates.length) return "partial";
  return false;
}

function recordCorrect(idx, ans) {
  partialAnswers = partialAnswers.filter(x => x.index !== idx);
  incorrectAnswers = incorrectAnswers.filter(x => x.index !== idx);
  const existing = correctAnswers.find(x => x.index === idx);
  if (existing) existing.userAnswer = ans;
  else correctAnswers.push({index:idx, userAnswer:ans});
}

function recordPartial(idx, ans) {
  correctAnswers = correctAnswers.filter(x => x.index !== idx);
  incorrectAnswers = incorrectAnswers.filter(x => x.index !== idx);
  const existing = partialAnswers.find(x => x.index === idx);
  if (existing) existing.userAnswer = ans;
  else partialAnswers.push({index:idx, userAnswer:ans});
}

function recordIncorrect(idx, ans) {
  partialAnswers = partialAnswers.filter(x => x.index !== idx);
  correctAnswers = correctAnswers.filter(x => x.index !== idx);
  const existing = incorrectAnswers.find(x => x.index === idx);
  if (existing) existing.userAnswer = ans;
  else incorrectAnswers.push({index:idx, userAnswer:ans});
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

/* ========= Rendering ========= */
function renderProgress() {
  const dots = document.getElementById('progressDots');
  dots.innerHTML = '';
  for (let i = 0; i < quizData.length; i++) {
    const dot = document.createElement('span');
    dot.className = 'dot';
    if (i === currentIndex) dot.classList.add('current');
    else if (correctAnswers.find(x => x.index === i)) dot.classList.add('correct');
    else if (partialAnswers.find(x => x.index === i)) dot.classList.add('partial');
    else if (incorrectAnswers.find(x => x.index === i)) dot.classList.add('incorrect');
    dots.appendChild(dot);
  }
  document.getElementById('progressText').textContent = `${currentIndex + 1} / ${quizData.length}`;
}

function renderImageClues(card) {
  const container = document.getElementById('imageArea');
  container.innerHTML = '';
  for (const clueKey of card.clues) {
    const imgData = IMAGE_LIBRARY[clueKey];
    if (!imgData) continue;
    const item = document.createElement('div');
    item.className = 'image-item';
    item.innerHTML = `<img src="${imgData.url}" alt="${imgData.caption}"/><div style="font-size:12px;color:#444;margin-top:6px;">${imgData.caption}</div>`;
    container.appendChild(item);
  }
}

function renderProperties(card) {
  const container = document.getElementById('propertiesArea');
  container.innerHTML = '';
  
  const props = [];
  if (card.oxReq) props.push(`Oxygen: ${card.oxReq}`);
  if (card.encapsulated !== undefined && card.encapsulated !== null) {
    const encapText = typeof card.encapsulated === 'string' ? card.encapsulated : (card.encapsulated ? 'yes' : 'no');
    props.push(`Encapsulated: ${encapText}`);
  }
  if (card.spore !== undefined) props.push(`Spore-forming: ${card.spore ? 'yes' : 'no'}`);
  
  if (props.length > 0) {
    const header = document.createElement('div');
    header.style.fontWeight = '600';
    header.style.marginBottom = '8px';
    header.textContent = 'Additional Properties:';
    container.appendChild(header);
    
    props.forEach(p => {
      const tag = document.createElement('span');
      tag.className = 'property-tag';
      tag.textContent = p;
      container.appendChild(tag);
    });
  }
}

/* ========= Flow control ========= */
function showCard() {
  if (currentIndex >= quizData.length) {
    showReview();
    return;
  }
  renderProgress();
  const card = quizData[currentIndex];
  renderImageClues(card);
  renderProperties(card);
  const feedback = document.getElementById('feedbackBox');
  feedback.style.display = 'none';
  feedback.textContent = '';
  document.getElementById('answerInput').value = '';
  document.getElementById('submitBtn').style.display = '';
  document.getElementById('nextBtn').style.display = 'none';
}

function handleSubmit() {
  const input = document.getElementById('answerInput').value || '';
  const card = quizData[currentIndex];
  const result = evaluateAnswer(input, card.name);
  const fb = document.getElementById('feedbackBox');
  
  if (result === true) {
    recordCorrect(currentIndex, input);
    fb.style.display = 'block';
    fb.style.background = '#ecfdf5';
    fb.style.border = '1px solid #bbf7d0';
    fb.style.color = '#065f46';
    fb.textContent = `✓ Correct — ${card.name}`;
    // Show Next button, don't auto-advance
    document.getElementById('submitBtn').style.display = 'none';
    document.getElementById('nextBtn').style.display = 'inline-block';
    renderProgress();
  } else if (result === "partial") {
    recordPartial(currentIndex, input);
    fb.style.display = 'block';
    fb.style.background = '#eff6ff';
    fb.style.border = '1px solid #bfdbfe';
    fb.style.color = '#1e40af';
    fb.textContent = `Partially correct — ${card.name}. You may add the missing portion to upgrade to full credit.`;
    // Keep Submit visible for upgrade, show Next to move on
    document.getElementById('submitBtn').style.display = 'inline-block';
    document.getElementById('nextBtn').style.display = 'inline-block';
    renderProgress();
  } else {
    recordIncorrect(currentIndex, input);
    fb.style.display = 'block';
    fb.style.background = '#fff1f2';
    fb.style.border = '1px solid #fecaca';
    fb.style.color = '#9f1239';
    fb.textContent = `✗ Incorrect — correct answer: ${card.name}`;
    // Show Next button, don't auto-advance
    document.getElementById('submitBtn').style.display = 'none';
    document.getElementById('nextBtn').style.display = 'inline-block';
    renderProgress();
  }
}

function handleNext() {
  currentIndex++;
  if (currentIndex >= quizData.length) showReview();
  else showCard();
}

/* ========= Review UI ========= */
function showReview() {
  document.getElementById('quizArea').style.display = 'none';
  const review = document.getElementById('reviewArea');
  review.style.display = '';
  const total = quizData.length;
  const correctCount = correctAnswers.length;
  const partialCount = partialAnswers.length;
  const incorrectCount = incorrectAnswers.length;
  
  let html = `<h2>Quiz Complete — Review</h2>`;
  html += `<div class="summary">Score: Correct: ${correctCount} | Partial: ${partialCount} | Incorrect: ${incorrectCount} | Total: ${total}</div>`;

  html += `<button class="accordion">Correct Answers (${correctCount})</button><div class="panel">`;
  if (correctAnswers.length===0) html += `<div style="padding:8px;color:#666">None</div>`;
  else {
    correctAnswers.forEach(entry => {
      const name = quizData[entry.index].name;
      html += `<div style="padding:8px;border-bottom:1px solid #eef2ff"><strong>${escapeHtml(name)}</strong><div style="font-size:13px;color:#444">You typed: ${escapeHtml(entry.userAnswer)}</div></div>`;
    });
  }
  html += `</div>`;

  html += `<button class="accordion">Partially Correct (${partialCount})</button><div class="panel">`;
  if (partialAnswers.length===0) html += `<div style="padding:8px;color:#666">None</div>`;
  else {
    partialAnswers.forEach(entry => {
      const name = quizData[entry.index].name;
      html += `<div style="padding:8px;border-bottom:1px solid #eef2ff"><strong>${escapeHtml(name)}</strong><div style="font-size:13px;color:#444">You typed: ${escapeHtml(entry.userAnswer)}</div></div>`;
    });
  }
  html += `</div>`;

  html += `<button class="accordion">Incorrect (${incorrectCount})</button><div class="panel">`;
  if (incorrectAnswers.length===0) html += `<div style="padding:8px;color:#666">None</div>`;
  else {
    incorrectAnswers.forEach(entry => {
      const name = quizData[entry.index].name;
      html += `<div style="padding:8px;border-bottom:1px solid #eef2ff"><strong>${escapeHtml(name)}</strong><div style="font-size:13px;color:#444">You typed: ${escapeHtml(entry.userAnswer)}</div></div>`;
    });
  }
  html += `</div>`;

  html += `<div style="margin-top:12px;"><button onclick="location.reload()">Restart Quiz</button></div>`;
  review.innerHTML = html;

  // Accordion functionality
  document.querySelectorAll('.accordion').forEach(acc => {
    acc.addEventListener('click', function() {
      this.classList.toggle('active');
      const panel = this.nextElementSibling;
      if (panel.style.display === 'block') panel.style.display = 'none';
      else panel.style.display = 'block';
    });
  });
}

/* ========= Init ========= */
function init() {
  quizData.sort(() => Math.random() - 0.5);
  showCard();
  document.getElementById('submitBtn').onclick = handleSubmit;
  document.getElementById('nextBtn').onclick = handleNext;
  document.getElementById('answerInput').onkeypress = function(e) {
    if (e.key === 'Enter') {
      const submitVisible = document.getElementById('submitBtn').style.display !== 'none';
      const nextVisible = document.getElementById('nextBtn').style.display !== 'none';
      
      if (submitVisible) {
        handleSubmit();
      } else if (nextVisible) {
        handleNext();
      }
    }
  };
}

init();
</script>
</body>
</html>
